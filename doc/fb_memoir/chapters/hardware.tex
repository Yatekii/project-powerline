% Plot from tabular data
%\begin{figure}
%    \begin{tikzpicture}
%       \begin{scope}[x={(0mm,0mm)},y={(170mm,\textwidth)}]
%           \begin{axis}[%
%                   xmode=log,
%                   height=80mm,
%                   width=\textwidth,
%                   at={(0,80mm)},
%                   %grid=both,
%               ]
%               \addplot[-,color=blue] table {data/measurement-inductor-1layer-inductance.dat};
%               %\addplot[-,color=blue] table {data/fetsim.dat};
%           \end{axis}
%           %\begin{axis}[%
%           %        height=80mm,
%           %        width=\textwidth,
%           %        at={(0,0mm)},
%           %        %grid=both,
%           %    ]
%           %    \addplot[-,color=red] table {data/fetsim.dat};
%           %\end{axis}
%       \end{scope}
%   \end{tikzpicture}
%\end{figure}

% **************************************************************************** %
\chapter{Hardware}
\label{chap:hardware}
% **************************************************************************** %

Das folgende Kapitel dokumentiert  unseren L\"osungsfindungsprozess im Bereich
Hardware. Zuerst  wird  auf  die  Problematik  der  Kommunikation  \"uber  die
DC-Leitung  zwischen  Solarmodul  und \Master  eingegangen. Es  werden  unsere
L\"osungsans\"atze erl\"autert  und auf St\"arken und  Schw\"achen untersucht,
um daraus anschliessend eine Entscheidung abzuleiten.

In   einem  n\"achsten   Schritt  werden   die  L\"osungskonzepte   f\"ur  die
Sensor-Platine und das \Master genauer erkl\"art.

\anweisung Verifizierbare  Angaben machen, nicht  allgemeine Floskeln. Zahlen,
Fakten,  theoretische Hintergrundinformationen,  daraus gezogene  Konsequenzen
etc. Bezug auf das Pflichtenheft, wo m\"oglich.

\anweisung Bilder, Diagramme, Formeln etc.


% ---------------------------------------------------------------------------- %
\section{Kommunikation \"uber DC-Leitung}
\label{sec:hardware:dcLeitung}
% ---------------------------------------------------------------------------- %

W\"ahrend  des   Projekts  wurden   zwei  L\"osungsans\"atze   untersucht,  um
ein  Signal  \"uber   die  Gleichstromleitung  vom  \Sensor   zum  \Master  zu
\"ubertragen. Der  Gleichstromanteil   bel\"auft  sich  in  der   Leitung  auf
ca. \SI{960}{\volt} \todo{Berechnung/Begr\"undung}.

\myfancybreak

\emph{Frequency-shift    keying}   (\emph{Frequenzumtastung}): Dem    in   der
Leitung    fliessenden    Gleichstrom     wird    ein    (verh\"altnism\"assig
kleines\todo{Amplitudenverh\"altnisse})    Wechselstromsignal    aufmoduliert,
welches   die   zu   \"ubertragenden   Informationen   enth\"alt. Dabei   wird
die    Frequenz   dieses    Wechselstromsignals    in   diskreten    Schritten
variiert,  \todo{korrekt?}   und  diese   \"Anderung  der  Frequenz   ist  der
Informationstr\"ager.  F\"ur einen kurzen \"Uberblick  zum Thema sie an dieser
Stelle auf Wikipedia verwiesen~\cite{ref:fsk:wikipedia}.

Das    Verfahren    ist   schematisch    in    Abbildung~\ref{fig:fsk:concept}
dargestellt.\todo{Achsen: Einheiten}

\begin{figure}[h!tb]
    \centering
    \input{images/python/fsk.pgf}
    \caption{%
        \emph{Frequency-shift  keying}: Oben   sind  die   zu  \"ubertragenden
        digitalen  Daten  als  \code{1}  und \code{0}  abgebildet,  unten  das
        zugeh\"orige Verhalten des  modulierten Signals. Dieses Signal w\"urde
        bei unserem System auf eine \SI{960}{\volt}-DC-Spannung aufmoduliert.%
    }
    \label{fig:fsk:concept}
\end{figure}

\myfancybreak

\emph{Amplitude-shift  keying}  (\emph{Amplitudenumtastung}): Statt  diskreten
Frequenzen werden in diesem  Fall diskrete Amplituden als Informationstr\"ager
benutzt. Die   Umsetzung    w\"urde   darauf   basieren,    dass   kurzfristig
(mit   Frequenzen   im  Bereich   von   einigen   Kilohertz)  ein   Solarmodul
\todo{Modul? Zelle? String?} in einem  String (Serieschaltung) kurzgeschlossen
w\"urde. Dies w\"urde die  auf der Leitung anliegende Spannung  in dieser Zeit
um  den Spannungsanteil  des kurzgeschlossenen  Moduls einbrechen  lassen. Die
Einbr\"uche  w\"urden  als  Informationstr\"ager   fungieren  und  im  \Master
ausgewertet.

Grunds\"atzlich handelt es  sich beim aufmodulierten Signal  um \emph{ASK} mit
zwei Amplituden: \SI{0}{\volt}  (wenn kein  Modul kurzgeschlossen ist  und ein
reiner Gleichstrom \"uber  die Leitung fliesst) und  einer negativen Amplitude
im Umfang der Spannung des kurzgeschlossenen Modules.

F\"ur  einen kurzen  Einblick ins  Thema  sei auch  an dieser  Stelle auf  den
entsprechenden Artikel auf Wikipedia verwiesen \cite{ref:ask:wikipedia}.

Abbildung~\ref{fig:ask:concept} stellt das  Konzept des Verfahrens schematisch
dar. \todo{Achsen: Einheiten}

\begin{figure}[h!tb]
    \centering
    \input{images/python/ask.pgf}
    \caption{%
        \emph{Amplitude-shift  keying}: Oben   sind  die   zu  \"ubertragenden
        digitalen  Daten  als  \code{1}  und \code{0}  abgebildet,  unten  das
        zugeh\"orige  Verhalten  des   \"ubertragenen  Signals. Die  Form  des
        Signals w\"urde  in unserem System  etwas anders aussehen, da  wir ein
        \SI{960}{\volt}-Signal  kurzzeitig um  jeweils  bis zu  \SI{60}{\volt}
        einbrechen lassen  w\"urden, anstatt mit  sch\"onen Sinus-Schwingungen
        zu arbeiten. Das  Konzept einer diskreten Anzahl  Frequenzen und ihrer
        Zuordnung zu entweder \code{0} oder \code{1} bleibt aber identisch.%
    }
    \label{fig:ask:concept}
\end{figure}
\todo{Verweis auf Simulationen}

Die  Implementierung   einer  FSK-L\"osung  ist  prinzipiell   dich  sicherere
Variante.  Fertige  Microchips, auf denen  man eine solche  Schaltung aufbauen
kann,  existieren  bereits  am  Markt. Die prim\"are  Schwierigkeit  liegt  in
der  Frage,  wie man  das  Signal  in  die DC-Leitung  einkoppelt. Wichtig  an
der  Einkopplung  ist,  dass  sie potentialgetrennt  von  der  DC-Leitung  ist
\todo{Korrekt? Begr\"undung?};  man kann  also  nicht  einfach die  DC-Leitung
mit   dem  Ausgang   des   Signalgebers  verbinden   \todo{Strom  geht   durch
Signalgeber? Spannung?} Daf\"ur bietet sich entweder eine kapazitive oder eine
induktive Einkopplung an \todo{Schaltungen}.

Ein  Modul kurzzuschliessen  und damit  eine  Form von  ASK zu  implementieren
w\"are  eine sehr  sparsame L\"osung  mit  minimalem Aufwand  (und somit  auch
Kosten) f\"ur die Schaltung. Allerdings  bringt sie einige Schwierigkeiten mit
sich. Es  ist  ein  Konzept,  das  nicht  verbreitet  und  gut  getestet  ist;
die  Machbarkeit  ist  nicht  garantiert. Es ist  daher  sinnvoll,  vor  einer
allf\"alligen Umsetzung so viele Informationen wie m\"oglich \"uber m\"ogliche
Problemzonen einzuholen, anhand  derer beurteilt werden kann,  ob die L\"osung
im Rahmen  des Projektes  realisiertbar ist,  oder ob  ein Erfolg  zu unsicher
w\"are.

% ---------------------------------------------------------------------------- %
\subsection{FSK: Kapazitive oder induktive Einkopplung}
\label{subsec:hw:fsk:kapaVsInduk}
% ---------------------------------------------------------------------------- %

Eine kapazitive Einkopplung hat die Vor- und Nachteile, dass \ldots, w\"ahrend
\ldots Nachteile sind.\todo{Vor- Nachteile}
\todo{Circuit}


Eine induktive Einkopplung legt eine  Spule um die DC-Leitung. Auf diese Spule
wird von der FSK-Schaltung das zu  \"ubertragende Signal gegeben und die Spule
induziert in  der DC-Leitung  entsprechende Spannungs-Rippel, die  vom \Master
ausgewertet werden k\"onnen. Der entsprechende  Schaltkreis ist schematisch in
Abbildung \ref{fig:circ:coupling:inductive} dargestellt.

Verglichen mit  Kondensatoren sind Spulen relativ  gross und teuer. Allerdings
ist das Prinzip  der induktiven Einkopplung gut dokumentiert  und die Aussicht
auf Erfolg (bei vern\"unftigem Aufwand) somit gut.

\begin{figure}[h!tb]
    \centering
    \input{images/circuits/coupling-inductive.tex}
    \caption{Induktive Einkopplung}
    \label{fig:circ:coupling:inductive}
\end{figure}


% ---------------------------------------------------------------------------- %
\subsection{ASK: Machbarkeitsanalyse}
\label{subsec:hw:ask:machbarkeit}
% ---------------------------------------------------------------------------- %

Um die Machbarkeit dieser L\"osungsvariante zu beurteilen, wurden Simulationen
durchgef\"uhrt. Dazu  wurde  zuerst  eine  Modellschaltung  entwickelt,  deren
Parameter  definiert  und  anschliessend   Simulationen  mit  der  definierten
Konfiguration durchgef\"uhrt.

Als   Simulationstool  wird   \code{LTspice   IV}   von  Linear   Technologies
eingesetzt~\cite{ref:ltspice}.


% ---------------------------------------------------------------------------- %
\subsubsection{Modellierung eines Solarmoduls}
\label{subsubsec:hw:ask:modell}
% ---------------------------------------------------------------------------- %

Als  Ausganspunkt  des  Modells  f\"ur ein  Modul  dient  das  Eindiodenmodell
\todo{Bindestrich  oder   ein  Wort?}   gem\"ass  Abbildung. Dabei   wird  das
klassische   Eindiodenmodell  um   einen  Kondensator   der  Kapazit\"at   $C$
parallel zur  Stromquelle erg\"anzt  (basierend auf Informationen  aus Quellen
\cite{ref:solar:scofield} und \cite{ref:solar:friesen}).

\begin{figure}[h!tb]
    \centering
    \input{images/circuits/solarCell.tex}
    \caption{%
        Schaltschema    zur    Modellierung    einer    Solarzelle    gem\"ass
        Eindiodenmodell mit zus\"atzlicher Kapazit\"at%
    }
    \label{fig:circuit:solarCell}
\end{figure}

Zur   Ermittlung  der   Parameter   dieses  Modells   wurde  pr\"imar   Quelle
\cite{ref:solar:scofield}  herangezogen. Es wurden  $C$,  $R_{S}$ und  $R_{P}$
einer   Solarzelle   der   Gr\"osse   \SI{0.43}{\centi\meter\squared}   \"uber
einen   Frequenzbereicht  von   \SI{1}{\kilo\hertz}  bis   \SI{1}{\mega\hertz}
ausgemessen. Die Resultate waren:

\begin{align}
    C_{\mathrm{Messung}}    &= \SI{8}{\nano\farad} \text{bis} \SI{20}{\nano\farad}  = \SI{14 \pm 6}{\nano\farad} \\
    R_{\mathrm{S, Messung}} &= \SI{0.2}{\ohm}      \text{bis} \SI{20}{\ohm}         = \SI{10.1 \pm 9.9}{\ohm}     \\
    R_{\mathrm{P, Messung}} &= \SI{0.5}{\kilo\ohm} \text{bis} \SI{500}{\kilo\ohm}   = \SI{250.25 \pm 249.75}{\kilo\ohm}
\end{align}

Um  die obigen  Werte  f\"ur  unsere Zwecke  verwenden  zu k\"onnen,  m\"ussen
sie   von  einer   Solarzelle  der   Gr\"osse  \SI{0.43}{\centi\meter\squared}
auf   die  Gr\"osse   einer   Zelle,   wie  sie   in   der  Praxis   verwendet
wird,  heraufskaliert   werden. Wir  werden   hierbei  von  einer   Zelle  der
Gr\"osse $\SI{100}{\milli\meter} \times  \SI{100}{\milli\meter}$ ausgehen, was
ungef\"ahr  der $230$-fachen  Fl\"ache  der Solarzellen  aus obigen  Messungen
entspricht.
\todo{Referenzen auf spezifische Textstellen?}

$R_{\mathrm{P}}$   und  $R_{\mathrm{S}}$   skalieren  umgekehrt   proportional
zur  Zellfl\"ache,  wogegen  $C$   bei  gr\"osser  werdender  Zelloberfl\"ache
ansteigt~\cite{ref:solar:scofield}. Wir  nehmen  die  Mittelwerte  aus  obigen
Gleichungen und bestimmen unsere Parameter:

\begin{align}
    C               &= C_{\mathrm{Messung}}    \cdot 230 = \SI{3.2}{\micro\farad} \\
    R_{\mathrm{S,}} &= R_{\mathrm{S, Messung}} \div  230 = \SI{44}{\milli\ohm}    \\
    R_{\mathrm{P,}} &= R_{\mathrm{P, Messung}} \div  230 = \SI{1.1}{\kilo\ohm}
\end{align}

Zur Bestimmung  werden die Spezifikationen eines  \emph{Solarex MSX-60}-Moduls
herangezogen  (verf\"ugbar in  Quelle \cite{ref:solar:bonkoungou}). Das  Modul
besteht  aus  36  in  Serie  verbundenen   Zellen  und  hat  einen  Strom  von
\todo{Kurzschlusstrom   oder   Peak-Power   Strom?}    \SI{3.8}{\ampere}   bei
maximaler  Leistungsabgabe. Die Stromquelle  im Modell  wird daher  auf diesen
Wert  eingestellt.
%Kurzzschlussstrom von \SI{3.8}{\ampere} bei
Die  Spannung  bei   maximaler  Leistungsabgabe  liegt  bei
\SI{17.1}{\volt}, die
Leerlaufspannung gem\"ass IV-Kurve bei etwa \SI{21}{\volt}.

Heruntergerechnet  auf  eine einzelne  Zelle  ergibt  dies eine  Spannung  bei
maximaler Leistungsabgabe von  \SI{475}{\milli\volt} und eine Leerlaufspannung
pro Zelle von \SI{580}{\milli\volt}.

Als  letzte Komponente  ist  die Diode  zu  bestimmen. Dies erfolgt  iterative
in  \code{LTspice}.
\todo{Erkl\"arung von IS und N}
\todo{Schema von LTspice}

\begin{itemize}
    \item
        Definition eines simplen  Diodenmodells mit gesch\"atzten Startwerten:
        \code{.model diode1 D(IS=1e-6 N=2)}
    \item
        Transientensimulation der Zelle: \code{.tran 1m}
    \item
        Messung    der   Zellenspannnung,    Vergleich   mit    Zielwert   von
        ca. \SI{580}{\milli\volt}
    \item
        \"Andern von  \code{IS} und  \code{N} im Diodenmodell  und Wiederholen
        des Vorgangs, bis ein zufriedenstellendes Ergebnis erzielt ist.
\end{itemize}

Nach einigen Iterationen liefert dieser Prozess:\todo{Einheiten}

\begin{align}
    \label{eq:cell:diode:IS:N:result}
    I_s &= 3e-6 \\
    N   &= 1.5
\end{align}


%\begin{figure}[h!tb]
%    \centering
%    \includegraphics[width=\textwidth]{images/ltspice/solarmodul-zellenbasiert.eps}
%    \caption{Solarmodul, modelliert durch 2 parallele Strings mit je 36 Zellen in Serie}
%    \label{fig:ltspice:solarmodul:cellBased}
%\end{figure}

% ---------------------------------------------------------------------------- %
\clearpage
\section{Sensorplatine}
\label{sec:hw:sensorplatine}
% ---------------------------------------------------------------------------- %

Was  ist der  Zweck  der Sensorplatine? Welche  Aufgaben  muss sie  erf\"ullen
k\"onnen? Wie ist sie aufgebaut? PCB-Layout? Energieversorgung?

\anweisung Dimensionierung der Bauteile: Berechnungen

% ---------------------------------------------------------------------------- %
\subsection{Energieversorgung}
\label{subsec:sensor:pcb}
% ---------------------------------------------------------------------------- %

Energiebezug,  Leistungsanforderungen, Standby,  Verhalten bei  ungen\"ugender
Leistungszufuhr, ...


% ---------------------------------------------------------------------------- %
\subsection{PCB}
\label{subsec:sensor:pcb}
% ---------------------------------------------------------------------------- %

Wie sieht das PCB aus, und weshalb?

% ---------------------------------------------------------------------------- %
\section{Master-Ger\"at}
\label{sec:hw:mastergerat}
% ---------------------------------------------------------------------------- %

Was ist der Zweck des Master-Ger\"ats? Aufgaben? Aufbau?

\anweisung Dimensionierung der Bauteile: Berechnungen


% ---------------------------------------------------------------------------- %
\subsection{Speisung}
\label{subsec:mastergerat:speisung}
% ---------------------------------------------------------------------------- %

Woher bezieht das Master-Ger\"at  seine Energie, weshalb? Wieviel Energie wird
ben\"otigt?


% ---------------------------------------------------------------------------- %
\subsection{Benutzer-Interface}
\label{subsec:mastergerat:interface}
% ---------------------------------------------------------------------------- %

\anweisung Das Benutzerinterface ist schon in der Anleitung im vorigen Kapitel
beschrieben worden. Es soll  hier um die Komponentenwahl gehen,  nicht um eine
Rekapitulation bereits gemachter Informationen.

% ---------------------------------------------------------------------------- %
\subsection{PCB}
\label{subsec:mastergerat:pcb}
% ---------------------------------------------------------------------------- %

Wie sieht das PCB aus, und weshalb?

% ---------------------------------------------------------------------------- %
\subsection{Montage/Geh\"ause}
\label{subsec:mastergerat:pcb}
% ---------------------------------------------------------------------------- %

Einbindung in die Umgebung, Wahl des Geh\"auses.


% ---------------------------------------------------------------------------- %
\section{Kommunikation}
\label{sec:kommunikation}
% ---------------------------------------------------------------------------- %

Die   Kommunikation  zwischen   Sensor  und   Master-Ger\"at  ist   eines  der
Herzst\"ucke des ganzen Systems und betrifft beide Sub-Systeme. Daher in einem
eigenen Abschnitt.

\begin{itemize}
    \item
        Grunds\"atzliches Problem
    \item
        Verfolgte L\"osungsans\"atze
    \item
        Ausgew\"ahlter L\"osungsansatz (mit Begr\"undung(en))
    \item
        Genauere Beschreibung dieses L\"osungsansatzes
\end{itemize}
