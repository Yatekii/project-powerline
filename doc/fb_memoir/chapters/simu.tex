% **************************************************************************** %
\chapter{L\"osungsans\"atze und Simulationen}
\label{chap:simu}
% **************************************************************************** %

Bevor  simuliert  werden  kann,  m\"ussen  die  daf\"ur  ben\"otigten  Modelle
vorhanden sein. In diesem Abschnitt wird zuerst ein Modell f\"ur eine PV-Zelle
bestimmt und  anschliessend benutzt,  um ein  PV-Modul aufzubauen.   Es werden
verschiedene L\"osungsans\"atze  pr\"asentiert, mit den  entwickelten Modellen
simuliert und die Resultate beurteilt.


% ---------------------------------------------------------------------------- %
\section{Modellierung einer PV-Zelle}
\label{sec:simu:model:cell}
% ---------------------------------------------------------------------------- %

\begin{wrapfigure}{r}{65mm}
    \centering
    \input{images/circuits/solarCell-1d.tex}
    \caption{%
        Eindiodenmodell  einer  PV-Zelle  mit  Stromquelle  $I_{\mathrm{Ph}}$,
        Diode  $D$,  Shunt-Widerstand $R_{\mathrm{Sh}}$~  und  Seriewiderstand
        $R_{\mathrm{S}}$.%
    }
    \label{fig:pvcell:1diode}
\end{wrapfigure}

Das Modell  einer idealien  Photovoltaikzelle ist  eine Stromquelle  mit einer
parallel geschalteten Diode. Da PV-Zellen in Realit\"at nicht ideal sind, wird
das einfachste Ersatzschaltbild einer PV-Zelle \"ublicherweise durch einen zur
Stromquelle parallel geschalteten Shunt-Widerstand $R_{\mathrm{Sh}}$ und einen
Seriewiderstand $R_{\mathrm{S}}$ erg\"anzt; das resultierende Ersatzschaltbild
ist in Abbildung \ref{fig:pvcell:1diode} dargestellt.

Die Genauigkeit  dieses Eindiodenmodells  ist jedoch h\"aufig  nicht besonders
gut  \cite{pvcell:phang}  \cite{pvcell:masmoudi}   (besonders  bei  niederigen
Beleuchtungsgraden),   weshalb   wir   hier  ein   Zweidiodenmodell   benutzen
werden. Eine  der  beiden  Dioden   modelliert  dabei  den  S\"attigungsstrom,
welcher von  Diffusionsprozessen verursacht wird, die  zweite Diode modelliert
den  S\"attigungsstrom,  welcher  von Rekombinationseffekten  verursacht  wird
\cite{pvcell:masmoudi}.

Zur Herleitung der Modellparamater existieren verschiedene Verfahren. Man kann
beispielsweise eine  PV-Zelle im Labor  ausmessen und die  Modellparameter aus
diesen  Messergebnissen  ableiten.   Dies  ist jedoch  nicht  immer  praktisch
realisierbar, da man allenfalls kein Testexemplar zur Verf\"ugung hat.  Sollen
bei  der  Messung  noch Fertigungstoleranzen  der  PV-Zellen  ber\"ucksichtigt
werden,  steigt der  experimentelle  (und  finanzielle) Aufwand  zus\"atzlich,
da  man  mehrere Exemplare  kaufen  und  ausmessen muss. Auch  die  Auswertung
erfordert mehr Arbeit, wenn  man mittels statistischer Methoden verl\"assliche
Schlussfolgerungen ziehen k\"onnen will.

Alternativ   kann   man   auch   versuchen,  die   Modellparameter   aus   dem
Datenblatt  einer  PV-Zelle  herzuleiten. Dies  bietet  zwei  haupts\"achliche
Vorteile: Einerseits  entfallen  aufw\"andige  Messungen   und  der  Kauf  von
Testexemplaren, andererseits ist davon auszugehen, dass der Hersteller mehrere
Exemplare ausgemessen hat  und typische Angaben in  den Datenbl\"atten gemacht
werden.  Es setzt jedoch voraus,  dass man den Herstellerangaben einigermassen
vertraut;  Sicherheit  ist  letztendlich  nur  durch  eigene  Verifikation  zu
erlangen.

Das Herleiten der Modellparameter aus den Herstellerangaben ist nicht trivial;
es wird deshalb  an dieser Stelle ein Modell  einer kommerziell erh\"altlichen
PV-Zelle  \todo{Hersteller   nennen}  als  Grundlage  verwendet,   welches  in
\cite{pvcell:masmoudi} hergeleitet und verifiziert worden ist.

\"Ublicherweise wird  bei PV-Zellen  nur das  Gleichstromverhalten untersucht;
das Verhalten  unter Wechselstrom interessiert meistens  nicht. Da das Signal,
welches  in  diesem  Projekt  auf die  DC-Leitung  aufmoduliert  wird,  jedoch
Wechselstrom ist,  sollte das  Wechselstromverhalten von PV-Zellen  in unseren
Simulationen ber\"ucksichtigt werden.

Das  Zweidiodenmodell  aus  \cite{pvcell:masmoudi}  wird  deshalb  in  unseren
Simulationen noch  durch eine  parallele Kapazit\"at erg\"anzt,  basierend auf
\cite{ref:solar:scofield}. Dies  liefert das  Modell  einer PV-Zelle  gem\"ass
Abbildung \ref{fig:circuit:solarCell}.

\begin{figure}[h!tb]
    \centering
    \input{images/circuits/solarCell.tex}
    \caption{%
        Schaltschema    zur    Modellierung    einer    Solarzelle    gem\"ass
        Zweidiodenmodell mit zus\"atzlicher Kapazit\"at%
    }
    \label{fig:circuit:solarCell}
\end{figure}


% ---------------------------------------------------------------------------- %
\clearpage
\section{Modellierung eines PV-Moduls}
\label{sec:simu:model:module}
% ---------------------------------------------------------------------------- %


\begin{figure}[h!tb]
    \centering
    \input{images/circuits/module72x1-simplified.tex}
    \caption{%
        Vereinfachtes      Schema      f\"ur      das      $72      \times
        1$-Modul: Ein     Strang    mit     72     Zellen     in     Serie
        geschaltet. Die  vollst\"andige  \code{LTspice}-Schaltung  ist  in
        Abbildung   \ref{fig:ltspice:module:cellBased:72x1}    auf   Seite
        \pageref{fig:ltspice:module:cellBased:72x1} dargestellt.%
    }
    \label{fig:circuit:72x1:simplified}
\end{figure}


% ---------------------------------------------------------------------------- %
\clearpage
\section{Modellierung eines Modulstrangs}
\label{sec:simu:model:module:string}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\section{Frequenzumtastung: Kapazitive Einkopplung}
\label{sec:simu:fsk:capacitive}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\subsection{Sender}
\label{sec:simu:fsk:capacitive:transmitter}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\subsection{Empf\"anger}
\label{sec:simu:fsk:capacitive:receiver}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\subsection{Gesamtsystem}
\label{sec:simu:fsk:capacitive:system}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\section{Frequenzumtastung: Induktive Einkopplung}
\label{sec:simu:fsk:inductive}
% ---------------------------------------------------------------------------- %

Eine induktive Einkopplung legt eine  Spule um die DC-Leitung. Auf diese Spule
wird von der FSK-Schaltung das zu  \"ubertragende Signal gegeben und die Spule
induziert in  der DC-Leitung  entsprechende Spannungs-Rippel, die  vom \Master
ausgewertet werden k\"onnen. Der entsprechende  Schaltkreis ist schematisch in
Abbildung \ref{fig:circ:coupling:inductive} dargestellt.

Verglichen mit  Kondensatoren sind Spulen relativ  gross und teuer. Allerdings
ist das Prinzip  der induktiven Einkopplung gut dokumentiert  und die Aussicht
auf Erfolg (bei vern\"unftigem Aufwand) somit gut.

\begin{figure}[h!tb]
    \centering
    \input{images/circuits/coupling-inductive.tex}
    \caption{Induktive Einkopplung}
    \label{fig:circ:coupling:inductive}
\end{figure}

% ---------------------------------------------------------------------------- %
\subsection{Sender}
\label{sec:simu:fsk:inductive:transmitter}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\subsection{Empf\"anger}
\label{sec:simu:fsk:inductive:receiver}
% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
\subsection{Gesamtsystem}
\label{sec:simu:fsk:inductive:inductive}
% ---------------------------------------------------------------------------- %


% ---------------------------------------------------------------------------- %
\section{Amplitudenumtastung}
\label{sec:simu:ask}
% ---------------------------------------------------------------------------- %

Wie in Abschnitt \todo{reference} erw\"ahnt, wird bei dieser L\"osungsvariante
jeweils   ein   Modul   gesteuert   kurzgeschlossen. Dies   verursacht   kurze
Spannungseinbr\"uche auf  der DC-Leitung,  welche vom  Empf\"anger ausgewertet
werden k\"onnen, wie in Abbildung \todo{reference}vereinfact dargestellt.

Potentielle Probleme sind bei  dieser L\"osungsvariante in folgenden Bereichen
zu suchen:

\begin{symbols}
    \firmlist
    \item[\textbf{Induktivit\"at der Leitung:}]
        Der  Spannungsabfall   auf  der  DC-Leitung  wird   bei  geschlossenem
        Stromkreis zu Strom\"anderungen auf der DC-Leitung f\"uhren. Dies wird
        eine Spannungs\"anderung auf der DC-Leitung bewirken\footnotemark.
        \footnotetext{%
            Spannung in Abh\"angigkeit der Strom\"anderung:
            $v = L \cdot \frac{\mathrm{d}i}{\mathrm{d}t}$%
        }

        Gem\"ass    Lenz'scher     Regel    \todo{reference}     wird    diese
        Spannungs\"anderung  so gerichtet  sein,  dass  sich der  zugeh\"orige
        Strom der aufgezwungenen \"Anderung widersetzt.

        Es  kann also  sein, dass  die  Induktivit\"at der  DC-Leitung das  zu
        \"ubertragende  Signal  so  stark  kompensiert,  dass  es  nicht  mehr
        detektierbar  ist. Je   h\"oher  die  Frequenz,  mit   der  das  Modul
        kurzgeschlossen  und  wieder  ge\"offnet   wird,  um  so  h\"oher  die
        zugeh\"origen Strom\"anderungen
        $\frac{\mathrm{d}i}{\mathrm{d}{t}}$
        und somit Impedanz der Induktivit\"at (gem\"ass
        $Z_L = j \omega L$).
    \item[\textbf{Kapazit\"at des Solarmoduls:}]
        Dem  Solarmodul   wird  bei   diesem  Vorgehen  das   Verhalten  einer
        Wechselstromquelle   aufgezwungen. Besitzt  es   interne  parasit\"are
        Kapazit\"aten,  k\"onnen  diese  bei  den  abrupten  \"Anderungen  der
        Spannung hohe Str\"ome im  kurzgeschlossenen Pfad und seinen Bauteilen
        verursachen.\footnotemark
        \footnotetext{%
            Strom\"anderung in Abh\"angigkeit der Spannungs\"anderung:
            $I(t) = C \cdot \frac{\mathrm{V(t)}}{\mathrm{d}t}$%
        }

        Besitzen    diese   Bauteile    Ohm'sche   Widerst\"ande,    entstehen
        entsprechende thermische  Verluste, welche die  Bauteile besch\"adigen
        k\"onnen.
\end{symbols}

Die    Tr\"agerfrequenz    in    den    folgenden    Simulationen    betr\"agt
\SI{10}{\kilo\hertz}.


% ---------------------------------------------------------------------------- %
\subsection{Sender}
\label{subsec:simu:ask:sensor}
% ---------------------------------------------------------------------------- %

Das  gesteuerte Kurzschliessen  des Moduls  wird mit  einem MOSFET  umgesetzt,
welcher zwischen  Eingang und  Ausgang des Moduls  durchschalten kann  und vom
Microcontroller auf dem Sensor gesteuert wird. \fref{fig:module:mosfet:simple}
zeigt diesen Aufbau schematisch.

Die  Ansteuerung des  Transistors  erfolgt mit  \SI{3.3}{\volt},  da dies  die
maximale Spannung  ist, welche der  auf dem Sensor  platzierte Microcontroller
ausgeben kann.

\begin{figure}[h!tb]
    \centering
    \input{images/circuits/moduleMOSFET.tex}
    \caption{%
        Gesteuerter     Kurzschluss     eines    Solarmoduls     mit     einem
        microcontroller-gesteuerten       Transistor. Die      vollst\"andigen
        \code{LTspice}-Schaltungen  sind  in Anhang  \ref{app:simu:module}  ab
        Seite \pageref{app:simu:module} dokumentiert.%
    }
    \label{fig:module:mosfet:simple}
\end{figure}

%TODO: line width
\begin{figure}
    \begin{tikzpicture}
       \begin{scope}[x={(0mm,0mm)},y={(120mm,\textwidth)}]
           \begin{axis}[%
                   height=40mm,
                   width=\textwidth,
                   at={(0,70mm)},
                   grid=both,
                   xlabel=Zeit (\si{\micro\second}),
                   ylabel=Strom (\si{\ampere}),
                   %x unit=u,
                   change x base=true,
                   %line width = 1pt,
                   thick,
                   x SI prefix=micro,
               ]
               \addplot[-,color=blue] table {data/module-72cells--I-MOSFET--0005u.dat};
           \end{axis}
           \begin{axis}[%
                   height=40mm,
                   width=\textwidth,
                   at={(0,35mm)},
                   grid=both,
                   xlabel=Zeit (\si{\micro\second}),
                   ylabel=Spannung (\si{\volt}),
                   %x unit=u,
                   change x base=true,
                   x SI prefix=micro,
               ]
               \addplot[-,color=magenta] table {data/module-72cells--U-MOSFET--0005u.dat};
           \end{axis}
           \begin{axis}[%
                   height=40mm,
                   width=\textwidth,
                   at={(0,0)},
                   grid=both,
                   xlabel=Zeit (\si{\micro\second}),
                   ylabel=Leistung (\si{\watt}),
                   %x unit=u,
                   change x base=true,
                   x SI prefix=micro,
               ]
               \addplot[-,color=teal] table {data/module-72cells--P-MOSFET--0005u.dat};
           \end{axis}
       \end{scope}
   \end{tikzpicture}
   \caption{%
       Verlauf    von    Strom,    Spannung    und    Leistung    am    MOSFET
       bei   einer   Schaltfrequenz   von   \SI{10}{\kilo\hertz}   bei   einer
       Modulkonfiguration    von    $36     \times    2$    Zellen    gem\"ass
       Schema    in    \fref{fig:ltspice:module:cellBased:36x2}   auf    Seite
       \ref{fig:ltspice:module:cellBased:36x2}.\protect\\
       Anhang       \ref{app:sec:simu:complementary:36x2}      auf       Seite
       \pageref{app:sec:simu:complementary:36x2} beinhaltet zum Vergleich noch
       Simulationen f\"ur den Zeitraum von einer Millisekunde.%
   }
   \label{fig:simu:results:36x2:3u}
\end{figure}

\begin{figure}
    \begin{tikzpicture}
       \begin{scope}[x={(0mm,0mm)},y={(120mm,\textwidth)}]
           \begin{axis}[%
                   height=40mm,
                   width=\textwidth,
                   at={(0,70mm)},
                   grid=both,
                   xlabel=Zeit (\si{\micro\second}),
                   ylabel=Strom (\si{\ampere}),
                   %x unit=u,
                   change x base=true,
                   x SI prefix=micro,
               ]
               \addplot[-,color=blue] table {data/module-72cells-series--I-MOSFET--0003u.dat};
           \end{axis}
           \begin{axis}[%
                   height=40mm,
                   width=\textwidth,
                   at={(0,35mm)},
                   grid=both,
                   xlabel=Zeit (\si{\micro\second}),
                   ylabel=Spannung (\si{\volt}),
                   %x unit=u,
                   change x base=true,
                   x SI prefix=micro,
               ]
               \addplot[-,color=magenta] table {data/module-72cells-series--U-MOSFET--0003u.dat};
           \end{axis}
           \begin{axis}[%
                   height=40mm,
                   width=\textwidth,
                   at={(0,0)},
                   grid=both,
                   xlabel=Zeit (\si{\micro\second}),
                   ylabel=Leistung (\si{\watt}),
                   %x unit=u,
                   change x base=true,
                   x SI prefix=micro,
               ]
               \addplot[-,color=teal] table {data/module-72cells-series--P-MOSFET--0003u.dat};
           \end{axis}
       \end{scope}
   \end{tikzpicture}
   \caption{%
       Verlauf    von    Strom,    Spannung    und    Leistung    am    MOSFET
       bei   einer   Schaltfrequenz   von   \SI{10}{\kilo\hertz}   bei   einer
       Modulkonfiguration    von    $72     \times    1$    Zellen    gem\"ass
       Schema    in    \fref{fig:ltspice:module:cellBased:36x2}   auf    Seite
       \ref{fig:ltspice:module:cellBased:72x1}. \protect\\
       Anhang     \ref{app:sec:simu:complementary:72x1}     auf     Seite
       \pageref{app:sec:simu:complementary:72x1} beinhaltet zum Vergleich noch
       Simulationen f\"ur den Zeitraum von einer Millisekunde.%
   }
   \label{fig:simu:results:72x1:3u}
\end{figure}

Die    Resultate   der    Simulation   f\"ur    ein   $36    \times   2$-Modul
sind   in   \fref{fig:simu:results:36x2:3u}   f\"ur  einen   Zeitbereich   von
\SI{3}{\micro\second}  dargestellt,  die  Ergebnisse   f\"ur  das  $72  \times
1$-Modul in \fref{fig:simu:results:72x1:3u}.  Tabelle \ref{tab:36x2:72x1:heat}
fasst   die  wichtigsten   Eckdaten  der   Simulationen  zusammen,   inklusive
Durchschnittswerte f\"ur Strom und Leistung.

\begin{table}[h!tb]
    \centering
    \caption{%
        Eckdaten zur Simulation des Kurzschlussverfahrens f\"ur ein Solarpanel
        mit  $36   \times  2$  Zellen  und   ein  Panel  mit  $72   \times  1$
        Zellen.\protect\\
        Bei     den     Durchschnittswerten     sind     sowohl     Ergebnisse
        f\"ur      \SI{1}{\milli\second}     wie      auch     \SI{1}{\second}
        angegeben,    um   zu    zeigen,   dass    sich   die    Konfiguration
        bereits    bei    einer    Millisekunde   stabilisiert    hat    (auch
        zu     sehen    in     Anhang    \ref{app:sec:simu:complementary:36x2}
        auf      Seite      \pageref{app:sec:simu:complementary:36x2}      und
        Anhang      \ref{app:sec:simu:complementary:72x1}       auf      Seite
        \pageref{app:sec:simu:complementary:72x1}).\protect\\
        Die     Dauer      der     Spitze     ist     beim      $36     \times
        2$-Modul     \SI{2}{\micro\second}    und     \SI{1.78}{\micro\second}
        beim    $72    \times    1$-Modul    (siehe    unterste    Plots    in
        den     Abbildungen      \ref{fig:simu:results:36x2:3u}     respektive
        \ref{fig:simu:results:72x1:3u}).%
    }
    \label{tab:36x2:72x1:heat}
    \begin{tabular}{lrr}

    \toprule
    Kriterium                                      & $36 \times 2$-Modul & $72 \times 1$-Modul \\
    \midrule
     Spitzenwert Strom:                            & \SI{32}{\ampere}    & \SI{24}{\ampere}    \\
     Spitzenwert Leistung:                         & \SI{310}{\watt}     & \SI{535}{\watt}     \\
     $\overline{P}$ f\"ur Dauer der Spitze         & \SI{158.77}{\watt}  & \SI{267.46}{\watt}  \\
     $\overline{P}$ f\"ur \SI{1}{\milli\second}    & \SI{4.312}{\watt}   & \SI{6.0577}{\watt}  \\
     $\overline{P}$ f\"ur \SI{1}{\second}          & \SI{4.3047}{\watt}  & \SI{6.0433}{\watt}  \\
    \bottomrule
    \end{tabular}
\end{table}

Aus \fref{fig:simu:results:36x2:5u}  und \tref{tab:36x2:72x1:heat}  ziehen wir
folgende Schlussfolgerungen:

\begin{enumerate}
    \firmlist
    \item
        Der  Spitzenwert f\"ur  den  Strom ist  hoch,  aber Transistoren,  die
        solche Str\"ome  verkraften k\"onnen,  sind zu  vern\"unftigen Preisen
        erh\"altlich.
    \item
        Die    Spitzenwerte    der    Leistungen   zwar    nur    sehr    kurz
        (etwa   \SI{2}{\micro\second}),   aber   sehr  hoch. Auch   wenn   der
        Durchschnittliche Leistungswert  weit unter  der Grenze  von g\"unstig
        erh\"altlichen  MOSFETs   liegt,  k\"onnte  die   Leistungsspitze  den
        Transistor irreversibel sch\"adigen.
    \item
        Der  durchschnittliche  Leistungsverbrauch  ist  weit  \"uber  dem  im
        Pflichtenheft angestrebten Wert von \SI{100}{\milli\watt}.
\end{enumerate}
\todo{korrekte Schlussfolgerungen?}


% ---------------------------------------------------------------------------- %
\clearpage
\subsection{\Master (Empf\"anger)}
\label{subsec:simu:ask:recv}
% ---------------------------------------------------------------------------- %


% ---------------------------------------------------------------------------- %
\subsection{Gesamtsystem}
\label{subsec:simu:ask:total}
% ---------------------------------------------------------------------------- %
