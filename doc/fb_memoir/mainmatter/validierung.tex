% **************************************************************************** %
\chapter{Validierung}
\label{chap:validierung}
% **************************************************************************** %

Im Folgenden  wird dargelegt,  welche Tests  an unserem  System durchgef\"uhrt
worden  sind, weshalb  die  durchgef\"uhrten Tests  relevant  sind und  welche
Ergebnisse erzielt werden konnten.

% ---------------------------------------------------------------------------- %
\section{Kopplungsspule}
\label{sec:val:coupling:coil}
% ---------------------------------------------------------------------------- %

Eine  Spule  leitet nicht  alle  Frequenzen  gleich gut. Zudem  s\"attigt  ein
Ferritkern  bei einem  bestimmten Strom. Deswegen  werden Frequenzg\"ange  der
Spule mit dem Ferritkern und  ein Power-Choke Test mit einer Sekund\"arwindung
gemacht.

Es   wird   die   Induktivit\"at   einer  Spule   getestet,   welche   mehrere
Windungen  \"ubereinander  hat  und  einer  Spule,  welche  nur  eine  Schicht
mit  Wicklungen   hat. Beide  Spulen   haben  genau  30   Wicklungen. Wie  man
Abbildung~\ref{fig:meas:coupling:coil:L} entnehmen kann, ist die Spule mit nur
einer  Wicklungsschicht  bis  \"uber  20  Megahertz  induktiv,  w\"ahrend  die
Multilayer-Spule  schon bei  4  Megahertz induktiv  wird. F\"ur unser  Projekt
haben  wir  deswegen  die  einschichtige  Spule  gew\"ahlt. Eine  Messung  der
Streuinduktivit\"at der gew\"ahlten Spule ist ebenfalls gemacht worden, um gut
damit rechnen und simulieren zu k\"onnen.

\begin{figure}[h!tb]
    \centering
    \input{images/fsk-meas/frequency_sweep_Ls.pgf}
    \caption[Messresultate Kopplungsspule]{Induktivitätsmessung der gewählten Spule}
    \label{fig:meas:coupling:coil:L}
\end{figure}

\begin{figure}[h!tb]
    \centering
    \input{images/fsk-meas/frequency_sweep_Rs.pgf}
    \caption[Messresultate Kopplungsspule]{Serienwiderstandsmessung der gewählten Spule}
    \label{fig:meas:coupling:coil:R}
\end{figure}
\todo{To Appendix}

Die  Power-Choke Tests  sind nur  f\"ur die  gew\"ahlte Einlayerspule  genacht
worden. Daf\"ur  wird durch  den Kern  eine kurzgeschlossene  Prim\"arwicklung
gef\"uhrt,   welche   dem   Aufbau  des   Endproduktes   entspricht. Wie   man
Grafik~\ref{fig:meas:coupling:power_choke:1} entnehmen kann,  f\"angt der Kern
bei  ungef\"ahr  \SI{2}{\ampere}  zu  s\"attigen an. Die  beiden  Kurven  sind
zwei  verschidene Messmethoden  (inkrementelle  Messung und  Sekantenmessung),
wobei  wir  hier  eher  der  inkrementellen  Messung  Beachtung  schenken,  da
hier  der   Kurvenverlauf  schlechter  ausf\"allt   und  wir  mit   dem  Worst
Case-Szenario rechnen. Uns interessiert  hier vorallem die Stromabh\"angigkeit
der  Induktivit\"at. Da das  Stromverh\"altnis im  Trafo durch  \ref{eq:trafo}
gegeben ist,  k\"onnen wir  bei 30  Windungen auf  der Prim\"arseite,  auf der
Sekund\"arseite \SI{60}{\ampere}  f\"uhren, ohne  den Kern  zu s\"attigen. Bei
den \SI{10}{\ampere}, die  die Stromzufuhr maximal f\"uhrt, ist  dies mehr als
ausreichend.

\begin{equation}\label{eq:trafo}
    I_S = \frac{I_P * N_P}{N_S}
\end{equation}

\begin{figure}[h!tb]
    \centering
    \input{images/fsk-meas/power_choke_I.pgf}
    \caption[Messresultate Kopplungsspule]{Kernsättigung der gewählten Spule in Abhängigkeit von I in Form der Induktivität}
    \label{fig:meas:coupling:coil:power_choke:1}
\end{figure}

\begin{figure}[h!tb]
    \centering
    \input{images/fsk-meas/power_choke_SUdt.pgf}
    \caption[Messresultate Kopplungsspule]{Kernsättigung der gewählten Spule in Abhängigkeit von $\int U dt$ in Form der Induktivität}
    \label{fig:meas:coupling:coil:power_choke:2}
\end{figure}
\todo{To Appendix}

% ---------------------------------------------------------------------------- %
\section{Modulator}
\label{sec:val:modulator}
% ---------------------------------------------------------------------------- %

Bei Modulator ist es besonders wichtig, ein sch\"ones Signal zu haben.

Wie               man               den               Kurven               aus
den                 Abbildungen~\ref{lst:meas:scope:0},~\ref{lst:meas:scope:1}
und~\ref{lst:meas:scope:6} entnehmen  kann, produziert der VCO  ein eigentlich
sch\"ones Signal. Jedoch gibt es  bei der Flanke \"Uberschwinger jeweils. Auch
ist  das Signal  ziemlich eckig,  was nicht  optimal ist. Dem  kann mit  einem
Tiefpassfilter entgegengewirkt werden.

Leider produziert der VCO ab und an auch mysteri\"ose Irregularit\"aten wie in
Abbildung~\ref{lst:meas:scope:1} gezeigt. Da der 74HC4640,  wovon der VCO Teil
ist, auch sonst nicht so funktionierte wie es dem Datenblatt zu entnehmen ist,
k\"onnte  es sein,  dass diese  Irregularit\"aten vom  Chip stammen. Sehr  gut
m\"oglich ist aber  auch, dass dort ein anderes Signal  eingekoppelt wird oder
es auf einen Messfehler zur\"uckzuf\"uhren ist.

Die Oszilloskop-Einstellungen  sind im  Anhang~\ref{app:sec:scope:settings} zu
finden.

\begin{figure}[h!tb]
    \centering
    \includegraphics[width=1\textwidth, trim=0mm 21mm 0mm 11mm, clip]{images/scopeShots/scope_0b.png}
    \caption{$VCO_{out}$ zoomed in, Parameter in Listing \ref{lst:meas:scope:0}}
    \label{fig:meas:scope:0}
\end{figure}

\begin{figure}[h!tb]
    \centering
    \includegraphics[width=1\textwidth, trim=0mm 21mm 0mm 11mm, clip]{images/scopeShots/scope_1b.png}
    \caption{$VCO_{out}$ mit Störungen, Parameter in Listing \ref{lst:meas:scope:1}}
    \label{fig:meas:scope:1}
\end{figure}

\begin{figure}[h!tb]
    \centering
    \includegraphics[width=1\textwidth, trim=0mm 21mm 0mm 11mm, clip]{images/scopeShots/scope_6b.png}
    \caption{$VCO_{out}$ zoomed out, Parameter in Listing \ref{lst:meas:scope:6}}
    \label{fig:meas:scope:6}
\end{figure}


% ---------------------------------------------------------------------------- %
\section{Demodulator}
\label{sec:val:demodulator}
% ---------------------------------------------------------------------------- %

Beim  Demodulator  ist  es   wichtig,  dass  die  Schaltflanken  einigermassen
Steil  sind  und   der  Signalverlauf  ansonsten  konstant.    Dass  dies  der
Fall ist,  kann den Abbildungen~\ref{lst:meas:scope:7},~\ref{lst:meas:scope:8}
und~\ref{lst:meas:scope:9} entnommen  werden.  Man sieht, dass  die Schaltzeit
etwa  \SI{2}{\micro\second} betr\"agt. Wenn  man nun  mit 9600  Baud empfangen
w\"urde,  erg\"abe dies  eine  Periode  von \SI{104}{\micro\second}.   Damit
w\"are die Schaltzeit lediglich 3.8 Prozent, was reibungslos funktioniert, wie
auch gut in  Grafik \ref{lst:meas:scope:8} zu erkennen ist.   Ein Problem, was
auf  den  Grafiken gut  sichtbar  ist,  ist  die geringe  Amplitude. Dem  wird
mithilfe  eines  Verst\"arkers  entgegengewirkt, welcher  die  Signalamplitude
verdoppelt.

\begin{figure}[h!tb]
    \centering
    \includegraphics[width=1\textwidth, trim=0mm 21mm 0mm 11mm, clip]{images/scopeShots/scope_7b.png}
    \caption{Rising Edge des Demodulators, Parameter in Listing \ref{lst:meas:scope:7}}
    \label{fig:meas:scope:7}
\end{figure}

\begin{figure}[h!tb]
    \centering
    \includegraphics[width=1\textwidth, trim=0mm 21mm 0mm 11mm, clip]{images/scopeShots/scope_8b.png}
    \caption{Rising Edge des Demodulators im Makroskopischen, Parameter in Listing \ref{lst:meas:scope:8}}
    \label{fig:meas:scope:8}
\end{figure}

\begin{figure}[h!tb]
    \centering
    \includegraphics[width=1\textwidth, trim=0mm 21mm 0mm 11mm, clip]{images/scopeShots/scope_9b.png}
    \caption{Falling Edge des Demodulators, Parameter in Listing \ref{lst:meas:scope:9}}
    \label{fig:meas:scope:9}
\end{figure}

% ---------------------------------------------------------------------------- %
\section{Gesamtsystem}
\label{sec:validierung:total}
% ---------------------------------------------------------------------------- %

Wie in den vorherigen Abschnitten dokumentiert ist, sind alle Teilsysteme getestet und funktionstüchtig.
Am Sensorboard müssen einige Anpassungen zum Einstellen der Trägerfrequenz der OOSK angepasst werden. Des Weiteren muss am Demodulator der Verstärker in Betrieb genommen werden, da im Moment die empfangene Signalamplitude zu klein ist, ansonsten aber in Ordnung.
Die Modulation und Demodulation wurden separat getestet. Nun ist es wichtig diese im Zusammenspiel zu testen. Dank ansonstem funktionstüchtigem Sensorboard mit kompletter Firmware, sollte dies einfach möglich sein.

Beim Master sieht die Lage ähnlich aus. Bis auf die Strommessung konnten alle Teilkomponenten erfolgreich getestet werden. Diese müssten jetzt im Vollbetrieb getestet werden, da dies Aufgrund fehlender Kommunikation der Sensoren bisher wegfiel.

Softwareseitig ist der Master auf gutem Wege.
Das Auslesen und Auswerten der Sensoren ist ohne Powerline-Communication sondern über normale UART getestet und funktioniert. Es wird das GUI angesteuert und eine Fehlermeldung ausgelöst wenn ein Modul defekt ist.
Jedoch fehlt ein wenig Politur. So fehlt noch die Ansteuerungssoftware für das GSM-Modul. Da dies vollintegriert ist, kann dies angenehm über TWI gemacht werden und ist ein einfacher Task sobald die restlichen Teilsysteme laufen.
Die Ansteuerung der Strommessung ist erledigt, konnte aber noch nicht getestet werden.
Zu guter Letzt ist eine gute Abrundung wichtig. So muss zum Beispiel noch der Button zum Ein- und Ausschalten des Displays angesteuert werden.
